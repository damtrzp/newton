{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst d3_shape_1 = require(\"d3-shape\");\n\nconst d3_selection_1 = require(\"d3-selection\");\n\nconst clamp_1 = __importDefault(require(\"clamp\"));\n\nconst utils_1 = __importDefault(require(\"./utils\"));\n\nconst globals_1 = __importDefault(require(\"./globals\"));\n\nconst eval_1 = require(\"./helpers/eval\");\n\nfunction mouseTip(config) {\n  config = Object.assign({\n    xLine: false,\n    yLine: false,\n    renderer: function (x, y) {\n      return '(' + x.toFixed(3) + ', ' + y.toFixed(3) + ')';\n    },\n    owner: null\n  }, config);\n  const MARGIN = 20;\n  const line = d3_shape_1.line().x(function (d) {\n    return d[0];\n  }).y(function (d) {\n    return d[1];\n  });\n\n  function lineGenerator(el, data) {\n    return el.append('path').datum(data).attr('stroke', 'grey').attr('stroke-dasharray', '5,5').attr('opacity', 0.5).attr('d', line);\n  }\n\n  let tipInnerJoin, tipInnerEnter;\n\n  function tip(selection) {\n    const join = selection.selectAll('g.tip').data(function (d) {\n      return [d];\n    }); // enter\n\n    const tipEnter = join.enter().append('g').attr('class', 'tip').attr('clip-path', 'url(#function-plot-clip-' + config.owner.id + ')'); // enter + update = enter inner tip\n\n    tipInnerJoin = join.merge(tipEnter).selectAll('g.inner-tip').data(function (d) {\n      // debugger\n      return [d];\n    });\n    tipInnerEnter = tipInnerJoin.enter().append('g').attr('class', 'inner-tip').style('display', 'none').each(function () {\n      const el = d3_selection_1.select(this);\n      lineGenerator(el, [[0, -config.owner.meta.height - MARGIN], [0, config.owner.meta.height + MARGIN]]).attr('class', 'tip-x-line').style('display', 'none');\n      lineGenerator(el, [[-config.owner.meta.width - MARGIN, 0], [config.owner.meta.width + MARGIN, 0]]).attr('class', 'tip-y-line').style('display', 'none');\n      el.append('circle').attr('r', 3);\n      el.append('text').attr('transform', 'translate(5,-5)');\n    }); // enter + update\n\n    tipInnerJoin.merge(tipInnerEnter).selectAll('.tip-x-line').style('display', config.xLine ? null : 'none');\n    tipInnerJoin.merge(tipInnerEnter).selectAll('.tip-y-line').style('display', config.yLine ? null : 'none');\n  }\n\n  tip.move = function (coordinates) {\n    let i;\n    let minDist = Infinity;\n    let closestIndex = -1;\n    let x, y;\n    const selection = tipInnerJoin.merge(tipInnerEnter);\n    const inf = 1e8;\n    const meta = config.owner.meta;\n    const data = selection.datum().data;\n    const xScale = meta.xScale;\n    const yScale = meta.yScale;\n    const width = meta.width;\n    const height = meta.height;\n    const x0 = coordinates.x;\n    const y0 = coordinates.y;\n\n    for (i = 0; i < data.length; i += 1) {\n      // skipTip=true skips the evaluation in the datum\n      // implicit equations cannot be evaluated with a single point\n      // parametric equations cannot be evaluated with a single point\n      // polar equations cannot be evaluated with a single point\n      if (data[i].skipTip || data[i].fnType !== 'linear') {\n        continue;\n      }\n\n      const range = data[i].range || [-inf, inf];\n      let candidateY;\n\n      if (x0 > range[0] - globals_1.default.TIP_X_EPS && x0 < range[1] + globals_1.default.TIP_X_EPS) {\n        try {\n          candidateY = eval_1.builtIn(data[i], 'fn', {\n            x: x0\n          });\n        } catch (e) {}\n\n        if (utils_1.default.isValidNumber(candidateY)) {\n          const tDist = Math.abs(candidateY - y0);\n\n          if (tDist < minDist) {\n            minDist = tDist;\n            closestIndex = i;\n          }\n        }\n      }\n    }\n\n    if (closestIndex !== -1) {\n      x = x0;\n\n      if (data[closestIndex].range) {\n        x = Math.max(x, data[closestIndex].range[0]);\n        x = Math.min(x, data[closestIndex].range[1]);\n      }\n\n      y = eval_1.builtIn(data[closestIndex], 'fn', {\n        x: x\n      });\n      tip.show();\n      config.owner.emit('tip:update', {\n        x,\n        y,\n        index: closestIndex\n      }); // @ts-ignore\n\n      const clampX = clamp_1.default(x, xScale.invert(-MARGIN), xScale.invert(width + MARGIN)); // @ts-ignore\n\n      const clampY = clamp_1.default(y, yScale.invert(height + MARGIN), yScale.invert(-MARGIN));\n      const color = utils_1.default.color(data[closestIndex], closestIndex);\n      selection.style('color', 'red');\n      selection.attr('transform', 'translate(' + xScale(clampX) + ',' + yScale(clampY) + ')');\n      selection.select('circle').attr('fill', color);\n      selection.select('text').attr('fill', color).text(config.renderer(x, y, closestIndex));\n    } else {\n      tip.hide();\n    }\n  };\n\n  tip.show = function () {\n    tipInnerJoin.merge(tipInnerEnter).style('display', null);\n  };\n\n  tip.hide = function () {\n    tipInnerJoin.merge(tipInnerEnter).style('display', 'none');\n  }; // generations of getters/setters\n\n\n  Object.keys(config).forEach(function (option) {\n    utils_1.default.getterSetter.call(tip, config, option);\n  });\n  return tip;\n}\n\nexports.default = mouseTip;","map":{"version":3,"mappings":"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","names":["mouseTip","config","Object","assign","xLine","yLine","renderer","x","y","toFixed","owner","MARGIN","line","d3_shape_1","d","lineGenerator","el","data","append","datum","attr","tipInnerJoin","tipInnerEnter","tip","selection","join","selectAll","tipEnter","enter","id","merge","style","each","d3_selection_1","meta","height","width","move","coordinates","i","minDist","Infinity","closestIndex","inf","xScale","yScale","x0","y0","length","skipTip","fnType","range","candidateY","globals_1","TIP_X_EPS","eval_1","e","utils_1","isValidNumber","tDist","Math","abs","max","min","show","emit","index","clampX","clamp_1","invert","clampY","color","select","text","hide","keys","forEach","option","getterSetter","call","exports"],"sources":["../src/tip.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}