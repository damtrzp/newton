{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst d3_selection_1 = require(\"d3-selection\");\n\nconst graph_types_1 = require(\"../graph-types/\");\n\nconst eval_1 = require(\"./eval\");\n\nconst datum_defaults_1 = __importDefault(require(\"../datum-defaults\"));\n\nfunction derivative(chart) {\n  const derivativeDatum = datum_defaults_1.default({\n    isHelper: true,\n    skipTip: true,\n    skipBoundsCheck: true,\n    nSamples: 2,\n    graphType: 'polyline'\n  });\n\n  function computeLine(d) {\n    if (!d.derivative) {\n      return [];\n    }\n\n    const x0 = typeof d.derivative.x0 === 'number' ? d.derivative.x0 : Infinity;\n    derivativeDatum.index = d.index;\n    derivativeDatum.scope = {\n      m: eval_1.builtIn(d.derivative, 'fn', {\n        x: x0\n      }),\n      x0: x0,\n      y0: eval_1.builtIn(d, 'fn', {\n        x: x0\n      })\n    };\n    derivativeDatum.fn = 'm * (x - x0) + y0';\n    return [derivativeDatum];\n  }\n\n  function checkAutoUpdate(d) {\n    const self = this;\n\n    if (!d.derivative) {\n      return;\n    }\n\n    if (d.derivative.updateOnMouseMove && !d.derivative.$$mouseListener) {\n      d.derivative.$$mouseListener = function (_ref) {\n        let {\n          x\n        } = _ref;\n\n        // update initial value to be the position of the mouse\n        // scope's x0 will be updated on the next call to `derivative(self)`\n        if (d.derivative) {\n          d.derivative.x0 = x;\n        } // trigger update (selection = self)\n\n\n        derivative(self);\n      }; // if d.derivative is destroyed and recreated, the tip:update event\n      // will be fired on the new d.derivative :)\n\n\n      chart.on('tip:update', d.derivative.$$mouseListener);\n    }\n  }\n\n  const derivative = function (selection) {\n    selection.each(function (d) {\n      const el = d3_selection_1.select(this);\n      const data = computeLine.call(selection, d);\n      checkAutoUpdate.call(selection, d);\n      const innerSelection = el.selectAll('g.derivative').data(data);\n      const innerSelectionEnter = innerSelection.enter().append('g').attr('class', 'derivative'); // enter + update\n\n      innerSelection.merge(innerSelectionEnter).call(graph_types_1.polyline(chart)); // update\n      // change the opacity of the line\n\n      innerSelection.merge(innerSelectionEnter).selectAll('path').attr('opacity', 0.5);\n      innerSelection.exit().remove();\n    });\n  };\n\n  return derivative;\n}\n\nexports.default = derivative;","map":{"version":3,"mappings":"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","names":["derivative","chart","derivativeDatum","datum_defaults_1","isHelper","skipTip","skipBoundsCheck","nSamples","graphType","computeLine","d","x0","Infinity","index","scope","m","eval_1","x","y0","fn","checkAutoUpdate","self","updateOnMouseMove","$$mouseListener","on","selection","each","el","d3_selection_1","data","call","innerSelection","selectAll","innerSelectionEnter","enter","append","attr","merge","graph_types_1","exit","remove","exports"],"sources":["../../src/helpers/derivative.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}