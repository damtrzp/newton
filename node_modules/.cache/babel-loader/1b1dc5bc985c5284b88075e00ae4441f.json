{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst interval_arithmetic_eval_1 = __importStar(require(\"interval-arithmetic-eval\"));\n\nconst eval_1 = require(\"../helpers/eval\");\n\nconst utils_1 = __importDefault(require(\"../utils\")); // const Interval = (intervalArithmeticEval as any).Interval\n// disable the use of typed arrays in interval-arithmetic to improve the performance\n\n\ninterval_arithmetic_eval_1.default.policies.disableRounding();\n\nfunction interval1d(chart, d, range, nSamples) {\n  const xCoords = utils_1.default.space(chart, range, nSamples);\n  const xScale = chart.meta.xScale;\n  const yScale = chart.meta.yScale;\n  const yMin = yScale.domain()[0];\n  const yMax = yScale.domain()[1];\n  const samples = [];\n  let i;\n\n  for (i = 0; i < xCoords.length - 1; i += 1) {\n    const x = {\n      lo: xCoords[i],\n      hi: xCoords[i + 1]\n    };\n    const y = eval_1.interval(d, 'fn', {\n      x: x\n    });\n\n    if (!interval_arithmetic_eval_1.Interval.isEmpty(y) && !interval_arithmetic_eval_1.Interval.isWhole(y)) {\n      samples.push([x, y]);\n    }\n\n    if (interval_arithmetic_eval_1.Interval.isWhole(y)) {\n      // means that the next and prev intervals need to be fixed\n      samples.push(null);\n    }\n  } // asymptote determination\n\n\n  for (i = 1; i < samples.length - 1; i += 1) {\n    if (!samples[i]) {\n      const prev = samples[i - 1];\n      const next = samples[i + 1];\n\n      if (prev && next && !interval_arithmetic_eval_1.Interval.intervalsOverlap(prev[1], next[1])) {\n        // case:\n        //\n        //   |\n        //\n        //     |\n        //\n        //   p n\n        if (prev[1].lo > next[1].hi) {\n          prev[1].hi = Math.max(yMax, prev[1].hi);\n          next[1].lo = Math.min(yMin, next[1].lo);\n        } // case:\n        //\n        //     |\n        //\n        //   |\n        //\n        //   p n\n\n\n        if (prev[1].hi < next[1].lo) {\n          prev[1].lo = Math.min(yMin, prev[1].lo);\n          next[1].hi = Math.max(yMax, next[1].hi);\n        }\n      }\n    }\n  }\n\n  samples.scaledDx = xScale(xCoords[1]) - xScale(xCoords[0]);\n  return [samples];\n}\n\nlet rectEps;\n\nfunction smallRect(x, y) {\n  return interval_arithmetic_eval_1.Interval.width(x) < rectEps;\n}\n\nfunction quadTree(x, y, meta) {\n  const sample = eval_1.interval(meta, 'fn', {\n    x: x,\n    y: y\n  });\n  const fulfills = interval_arithmetic_eval_1.Interval.zeroIn(sample);\n\n  if (!fulfills) {\n    return this;\n  }\n\n  if (smallRect(x, y)) {\n    this.push([x, y]);\n    return this;\n  }\n\n  const midX = x.lo + (x.hi - x.lo) / 2;\n  const midY = y.lo + (y.hi - y.lo) / 2;\n  const east = {\n    lo: midX,\n    hi: x.hi\n  };\n  const west = {\n    lo: x.lo,\n    hi: midX\n  };\n  const north = {\n    lo: midY,\n    hi: y.hi\n  };\n  const south = {\n    lo: y.lo,\n    hi: midY\n  };\n  quadTree.call(this, east, north, meta);\n  quadTree.call(this, east, south, meta);\n  quadTree.call(this, west, north, meta);\n  quadTree.call(this, west, south, meta);\n}\n\nfunction interval2d(chart, meta) {\n  const xScale = chart.meta.xScale;\n  const xDomain = chart.meta.xScale.domain();\n  const yDomain = chart.meta.yScale.domain();\n  const x = {\n    lo: xDomain[0],\n    hi: xDomain[1]\n  };\n  const y = {\n    lo: yDomain[0],\n    hi: yDomain[1]\n  };\n  const samples = []; // 1 px\n\n  rectEps = xScale.invert(1) - xScale.invert(0);\n  quadTree.call(samples, x, y, meta);\n  samples.scaledDx = 1;\n  return [samples];\n}\n\nconst sampler = function (chart, d, range, nSamples) {\n  const fnTypes = {\n    implicit: interval2d,\n    linear: interval1d\n  };\n\n  if (!fnTypes.hasOwnProperty(d.fnType)) {\n    throw Error(d.fnType + ' is not supported in the `interval` sampler');\n  } // @ts-ignore\n\n\n  return fnTypes[d.fnType].apply(null, arguments);\n};\n\nexports.default = sampler;","map":{"version":3,"mappings":"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","names":["interval_arithmetic_eval_1","policies","disableRounding","interval1d","chart","d","range","nSamples","xCoords","utils_1","space","xScale","meta","yScale","yMin","domain","yMax","samples","i","length","x","lo","hi","y","eval_1","isEmpty","isWhole","push","prev","next","intervalsOverlap","Math","max","min","scaledDx","rectEps","smallRect","width","quadTree","sample","fulfills","zeroIn","midX","midY","east","west","north","south","call","interval2d","xDomain","yDomain","invert","sampler","fnTypes","implicit","linear","hasOwnProperty","fnType","Error","apply","arguments","exports"],"sources":["../../src/samplers/interval.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}