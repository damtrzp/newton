{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst d3_selection_1 = require(\"d3-selection\");\n\nconst d3_shape_1 = require(\"d3-shape\");\n\nconst clamp_1 = __importDefault(require(\"clamp\"));\n\nconst utils_1 = __importDefault(require(\"../utils\"));\n\nconst evaluate_1 = __importDefault(require(\"../evaluate\"));\n\nfunction polyline(chart) {\n  function plotLine(selection) {\n    selection.each(function (d) {\n      const el = plotLine.el = d3_selection_1.select(this);\n      const index = d.index;\n      const evaluatedData = evaluate_1.default(chart, d);\n      const color = utils_1.default.color(d, index); // join\n\n      const innerSelection = el.selectAll(':scope > path.line').data(evaluatedData);\n      const yRange = chart.meta.yScale.range();\n      let yMax = yRange[0];\n      let yMin = yRange[1]; // workaround, clamp assuming that the bounds are finite but huge\n\n      const diff = yMax - yMin;\n      yMax += diff * 1e6;\n      yMin -= diff * 1e6;\n\n      if (d.skipBoundsCheck) {\n        yMax = Infinity;\n        yMin = -Infinity;\n      }\n\n      function y(d) {\n        return clamp_1.default(chart.meta.yScale(d[1]), yMin, yMax);\n      }\n\n      const line = d3_shape_1.line().curve(d3_shape_1.curveLinear).x(function (d) {\n        return chart.meta.xScale(d[0]);\n      }).y(y);\n      const area = d3_shape_1.area().x(function (d) {\n        return chart.meta.yScale(d[0]);\n      }).y0(chart.meta.yScale(0)).y1(y);\n      const innerSelectionEnter = innerSelection.enter().append('path').attr('class', 'line line-' + index).attr('stroke-width', 1).attr('stroke-linecap', 'round'); // enter + update\n\n      innerSelection.merge(innerSelectionEnter).each(function () {\n        const path = d3_selection_1.select(this);\n        let pathD;\n\n        if (d.closed) {\n          path.attr('fill', color);\n          path.attr('fill-opacity', 0.3);\n          pathD = area;\n        } else {\n          path.attr('fill', 'none');\n          pathD = line;\n        }\n\n        path.attr('stroke', color).attr('marker-end', function () {\n          // special marker for vectors\n          return d.fnType === 'vector' ? 'url(#' + chart.markerId + ')' : null;\n        }).attr('d', pathD);\n\n        if (d.attr) {\n          for (let k in d.attr) {\n            if (d.attr.hasOwnProperty(k)) {\n              path.attr(k, d.attr[k]);\n            }\n          }\n        }\n      }); // exit\n\n      innerSelection.exit().remove();\n    });\n  }\n\n  return plotLine;\n}\n\nexports.default = polyline;","map":{"version":3,"mappings":"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","names":["polyline","chart","plotLine","selection","each","d","el","d3_selection_1","index","evaluatedData","evaluate_1","color","utils_1","innerSelection","selectAll","data","yRange","meta","yScale","range","yMax","yMin","diff","skipBoundsCheck","Infinity","y","clamp_1","line","d3_shape_1","curve","x","xScale","area","y0","y1","innerSelectionEnter","enter","append","attr","merge","path","pathD","closed","fnType","markerId","k","hasOwnProperty","exit","remove","exports"],"sources":["../../src/graph-types/polyline.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}