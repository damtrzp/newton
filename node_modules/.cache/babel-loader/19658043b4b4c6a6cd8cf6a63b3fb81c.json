{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst d3_selection_1 = require(\"d3-selection\");\n\nconst evaluate_1 = __importDefault(require(\"../evaluate\"));\n\nconst utils_1 = __importDefault(require(\"../utils\"));\n\nfunction interval(chart) {\n  let minWidthHeight;\n  const xScale = chart.meta.xScale;\n  const yScale = chart.meta.yScale;\n\n  function clampRange(vLo, vHi, gLo, gHi) {\n    // issue 69\n    // by adding the option `invert` to both the xAxis and the `yAxis`\n    // it might be possible that after the transformation to canvas space\n    // the y limits of the rectangle get inverted i.e. gLo > gHi\n    //\n    // e.g.\n    //\n    //   functionPlot({\n    //     target: '#playground',\n    //     yAxis: { invert: true },\n    //     // ...\n    //   })\n    //\n    if (gLo > gHi) {\n      const t = gLo;\n      gLo = gHi;\n      gHi = t;\n    }\n\n    const hi = Math.min(vHi, gHi);\n    const lo = Math.max(vLo, gLo);\n\n    if (lo > hi) {\n      // no overlap\n      return [-minWidthHeight, 0];\n    }\n\n    return [lo, hi];\n  }\n\n  const line = function (points, closed) {\n    let path = '';\n    const range = yScale.range();\n    const minY = Math.min.apply(Math, range);\n    const maxY = Math.max.apply(Math, range);\n\n    for (let i = 0, length = points.length; i < length; i += 1) {\n      if (points[i]) {\n        const x = points[i][0];\n        const y = points[i][1];\n        let yLo = y.lo;\n        let yHi = y.hi; // if options.closed is set to true then one of the bounds must be zero\n\n        if (closed) {\n          yLo = Math.min(yLo, 0);\n          yHi = Math.max(yHi, 0);\n        } // points.scaledDX is added because of the stroke-width\n\n\n        const moveX = xScale(x.lo) + points.scaledDx / 2;\n        const viewportY = clampRange(minY, maxY, isFinite(yHi) ? yScale(yHi) : -Infinity, isFinite(yLo) ? yScale(yLo) : Infinity);\n        const vLo = viewportY[0];\n        const vHi = viewportY[1];\n        path += ' M ' + moveX + ' ' + vLo;\n        path += ' v ' + Math.max(vHi - vLo, minWidthHeight);\n      }\n    }\n\n    return path;\n  };\n\n  function plotLine(selection) {\n    selection.each(function (d) {\n      const el = plotLine.el = d3_selection_1.select(this);\n      const index = d.index;\n      const closed = d.closed;\n      const evaluatedData = evaluate_1.default(chart, d);\n      const innerSelection = el.selectAll(':scope > path.line').data(evaluatedData); // the min height/width of the rects drawn by the path generator\n\n      minWidthHeight = Math.max(evaluatedData[0].scaledDx, 1);\n      const innerSelectionEnter = innerSelection.enter().append('path').attr('class', 'line line-' + index).attr('fill', 'none'); // enter + update\n\n      const selection = innerSelection.merge(innerSelectionEnter).attr('stroke-width', minWidthHeight).attr('stroke', utils_1.default.color(d, index)).attr('opacity', closed ? 0.5 : 1).attr('d', function (d) {\n        return line(d, closed);\n      });\n\n      if (d.attr) {\n        for (let k in d.attr) {\n          if (d.attr.hasOwnProperty(k)) {\n            selection.attr(k, d.attr[k]);\n          }\n        }\n      }\n\n      innerSelection.exit().remove();\n    });\n  }\n\n  return plotLine;\n}\n\nexports.default = interval;","map":{"version":3,"mappings":"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","names":["interval","chart","minWidthHeight","xScale","meta","yScale","clampRange","vLo","vHi","gLo","gHi","t","hi","Math","min","lo","max","line","points","closed","path","range","minY","apply","maxY","i","length","x","y","yLo","yHi","moveX","scaledDx","viewportY","isFinite","Infinity","plotLine","selection","each","d","el","d3_selection_1","index","evaluatedData","evaluate_1","innerSelection","selectAll","data","innerSelectionEnter","enter","append","attr","merge","utils_1","color","k","hasOwnProperty","exit","remove","exports"],"sources":["../../src/graph-types/interval.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}