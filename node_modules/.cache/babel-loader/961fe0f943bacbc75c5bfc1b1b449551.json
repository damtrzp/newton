{"ast":null,"code":"'use strict';\n\nvar Parser = require('mr-parser').Parser;\n\nvar Interpreter = require('./Interpreter');\n\nvar extend = require('extend');\n\nfunction CodeGenerator(options, defs) {\n  this.statements = [];\n  this.defs = defs || {};\n  this.interpreter = new Interpreter(this, options);\n}\n\nCodeGenerator.prototype.setDefs = function (defs) {\n  this.defs = extend(this.defs, defs);\n  return this;\n};\n\nCodeGenerator.prototype.compile = function (namespace) {\n  if (!namespace || !(typeof namespace === 'object' || typeof namespace === 'function')) {\n    throw TypeError('namespace must be an object');\n  }\n\n  if (typeof namespace.factory !== 'function') {\n    throw TypeError('namespace.factory must be a function');\n  } // definitions available in the function\n  // each property under this.defs is mapped to local variables\n  // e.g\n  //\n  //  function (defs) {\n  //    var ns = defs['ns']\n  //    // code generated for the expression\n  //  }\n\n\n  this.defs.ns = namespace;\n  this.defs.$$mathCodegen = {\n    getProperty: function (symbol, scope, ns) {\n      if (symbol in scope) {\n        return scope[symbol];\n      }\n\n      if (symbol in ns) {\n        return ns[symbol];\n      }\n\n      throw SyntaxError('symbol \"' + symbol + '\" is undefined');\n    },\n    functionProxy: function (fn, name) {\n      if (typeof fn !== 'function') {\n        throw SyntaxError('symbol \"' + name + '\" must be a function');\n      }\n\n      return fn;\n    }\n  };\n\n  this.defs.$$processScope = this.defs.$$processScope || function () {};\n\n  var defsCode = Object.keys(this.defs).map(function (name) {\n    return 'var ' + name + ' = defs[\"' + name + '\"]';\n  }); // statement join\n\n  if (!this.statements.length) {\n    throw Error('there are no statements saved in this generator, make sure you parse an expression before compiling it');\n  } // last statement is always a return statement\n\n\n  this.statements[this.statements.length - 1] = 'return ' + this.statements[this.statements.length - 1];\n  var code = this.statements.join(';');\n  var factoryCode = defsCode.join('\\n') + '\\n' + ['return {', '  eval: function (scope) {', '    scope = scope || {}', '    $$processScope(scope)', '    ' + code, '  },', \"  code: '\" + code + \"'\", '}'].join('\\n');\n  /* eslint-disable */\n\n  var factory = new Function('defs', factoryCode);\n  return factory(this.defs);\n  /* eslint-enable */\n};\n\nCodeGenerator.prototype.parse = function (code) {\n  var self = this;\n  var program = new Parser().parse(code);\n  this.statements = program.blocks.map(function (statement) {\n    return self.interpreter.next(statement);\n  });\n  return this;\n};\n\nmodule.exports = CodeGenerator;","map":{"version":3,"names":["Parser","require","Interpreter","extend","CodeGenerator","options","defs","statements","interpreter","prototype","setDefs","compile","namespace","TypeError","factory","ns","$$mathCodegen","getProperty","symbol","scope","SyntaxError","functionProxy","fn","name","$$processScope","defsCode","Object","keys","map","length","Error","code","join","factoryCode","Function","parse","self","program","blocks","statement","next","module","exports"],"sources":["/home/programowanie/newton-rhapson/newton/node_modules/math-codegen/lib/CodeGenerator.js"],"sourcesContent":["'use strict'\n\nvar Parser = require('mr-parser').Parser\nvar Interpreter = require('./Interpreter')\nvar extend = require('extend')\n\nfunction CodeGenerator (options, defs) {\n  this.statements = []\n  this.defs = defs || {}\n  this.interpreter = new Interpreter(this, options)\n}\n\nCodeGenerator.prototype.setDefs = function (defs) {\n  this.defs = extend(this.defs, defs)\n  return this\n}\n\nCodeGenerator.prototype.compile = function (namespace) {\n  if (!namespace || !(typeof namespace === 'object' || typeof namespace === 'function')) {\n    throw TypeError('namespace must be an object')\n  }\n  if (typeof namespace.factory !== 'function') {\n    throw TypeError('namespace.factory must be a function')\n  }\n\n  // definitions available in the function\n  // each property under this.defs is mapped to local variables\n  // e.g\n  //\n  //  function (defs) {\n  //    var ns = defs['ns']\n  //    // code generated for the expression\n  //  }\n  this.defs.ns = namespace\n  this.defs.$$mathCodegen = {\n    getProperty: function (symbol, scope, ns) {\n      if (symbol in scope) {\n        return scope[symbol]\n      }\n      if (symbol in ns) {\n        return ns[symbol]\n      }\n      throw SyntaxError('symbol \"' + symbol + '\" is undefined')\n    },\n    functionProxy: function (fn, name) {\n      if (typeof fn !== 'function') {\n        throw SyntaxError('symbol \"' + name + '\" must be a function')\n      }\n      return fn\n    }\n  }\n  this.defs.$$processScope = this.defs.$$processScope || function () {}\n\n  var defsCode = Object.keys(this.defs).map(function (name) {\n    return 'var ' + name + ' = defs[\"' + name + '\"]'\n  })\n\n  // statement join\n  if (!this.statements.length) {\n    throw Error('there are no statements saved in this generator, make sure you parse an expression before compiling it')\n  }\n\n  // last statement is always a return statement\n  this.statements[this.statements.length - 1] = 'return ' + this.statements[this.statements.length - 1]\n\n  var code = this.statements.join(';')\n  var factoryCode = defsCode.join('\\n') + '\\n' + [\n    'return {',\n    '  eval: function (scope) {',\n    '    scope = scope || {}',\n    '    $$processScope(scope)',\n    '    ' + code,\n    '  },',\n    \"  code: '\" + code + \"'\",\n    '}'\n  ].join('\\n')\n\n  /* eslint-disable */\n  var factory = new Function('defs', factoryCode)\n  return factory(this.defs)\n  /* eslint-enable */\n}\n\nCodeGenerator.prototype.parse = function (code) {\n  var self = this\n  var program = new Parser().parse(code)\n  this.statements = program.blocks.map(function (statement) {\n    return self.interpreter.next(statement)\n  })\n  return this\n}\n\nmodule.exports = CodeGenerator\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}